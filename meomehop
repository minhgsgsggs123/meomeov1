local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Icon IDs (Đã thay bằng icon mẫu từ Roblox, bạn có thể thay đổi)
local IconIDs = {
    Discord = "rbxassetid://3067272719", -- Thông tin
    Farm = "rbxassetid://4977457781",    -- Nhà/Cây
    Sea = "rbxassetid://6325946110",     -- Sóng biển
    Islands = "rbxassetid://6253689230", -- Đảo/Cây cọ
    Quests = "rbxassetid://6317769850",  -- Kiếm/Nhiệm vụ
    Fruit = "rbxassetid://6445980004",   -- Trái cây
    Stats = "rbxassetid://6466723223",   -- Biểu đồ
    Teleport = "rbxassetid://6316223201",-- Mục tiêu/Bắn
    Visual = "rbxassetid://6467368307",  -- Mắt/Nhìn
    Shop = "rbxassetid://6465839019",    -- Giỏ hàng
    Misc = "rbxassetid://6465646194"     -- Bánh răng
}

-- Bảng màu Hồng/Trắng mới, dựa trên UI gốc của bạn
local Colors = {
    White = Color3.fromRGB(255, 255, 255),
    Background = Color3.fromRGB(255, 250, 252),      -- Nền chính (Trắng kem/Hồng nhạt)
    Sidebar = Color3.fromRGB(255, 240, 245),         -- Sidebar/Tab nền (Hồng phấn nhạt)
    Header = Color3.fromRGB(255, 182, 193),          -- Header (Hồng nhạt/Hồng dâu)
    TabButton = Color3.fromRGB(255, 240, 245),       -- Nút tab (Bình thường)
    TabHover = Color3.fromRGB(255, 230, 235),        -- Nút tab (Hover)
    TabActive = Color3.fromRGB(255, 255, 255),       -- Nút tab (Đang chọn - Trắng)
    TextPrimary = Color3.fromRGB(80, 30, 60),        -- Chữ đậm (Đỏ thẫm/Tím đậm)
    TextSecondary = Color3.fromRGB(150, 70, 100),    -- Chữ phụ
    Accent = Color3.fromRGB(255, 105, 180),          -- Màu nhấn (Hồng đậm/Hot Pink - dùng cho Highlight)
    ToggleBtn = Color3.fromRGB(255, 240, 245),       -- Nút toggle (Hồng phấn nhạt)
    ToggleStroke = Color3.fromRGB(255, 182, 193),    -- Viền/Stroke (Hồng nhạt)
}

-- Kích thước MainFrame
local MAIN_SIZE_X = 500
local MAIN_SIZE_Y = 380

-- Chiều rộng Sidebar
local SIDEBAR_WIDTH = 220 -- Tăng chiều rộng để vừa tên tab dài

-- Tạo ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "redzHub_BloxFruits"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

-- Nút toggle menu (giữ nguyên phong cách UI gốc của bạn)
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Name = "MenuToggle"
ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
ToggleBtn.Position = UDim2.new(0, 20, 0, 20)
ToggleBtn.BackgroundColor3 = Colors.ToggleBtn
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Active = true
ToggleBtn.Draggable = true
ToggleBtn.Parent = gui

-- Thêm viền màu hồng nhạt
local ToggleStroke = Instance.new("UIStroke")
ToggleStroke.Color = Colors.ToggleStroke
ToggleStroke.Thickness = 2
ToggleStroke.Parent = ToggleBtn

-- Bo tròn nút toggle
local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 12)
ToggleCorner.Parent = ToggleBtn

-- Icon bên trong nút toggle (dùng icon mẫu của bạn)
local ToggleIcon = Instance.new("ImageLabel")
ToggleIcon.Name = "Icon"
ToggleIcon.Size = UDim2.new(0.6, 0, 0.6, 0)
ToggleIcon.AnchorPoint = Vector2.new(0.5, 0.5)
ToggleIcon.Position = UDim2.new(0.5, 0, 0.5, 0)
ToggleIcon.BackgroundTransparency = 1
ToggleIcon.Image = "rbxassetid://74593584475472" -- Ảnh ID của bạn
ToggleIcon.ScaleType = Enum.ScaleType.Fit
ToggleIcon.Parent = ToggleBtn

-- Frame chính (MainFrame)
local Main = Instance.new("Frame")
Main.Name = "MainFrame"
Main.Size = UDim2.new(0, MAIN_SIZE_X, 0, MAIN_SIZE_Y)
Main.Position = UDim2.new(0.5, -MAIN_SIZE_X / 2, 0.5, -MAIN_SIZE_Y / 2)
Main.BackgroundColor3 = Colors.Background
Main.BorderSizePixel = 0
Main.Active = true
Main.Draggable = true
Main.Visible = true -- Tự động bật khi chạy script
Main.Parent = gui

-- Bo tròn MainFrame
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = Main

-- Header (Thanh trên cho tiêu đề)
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 36)
Header.BackgroundColor3 = Colors.Header
Header.BorderSizePixel = 0
Header.Parent = Main

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 10)
HeaderCorner.Parent = Header

-- Tiêu đề
local Title = Instance.new("TextLabel")
Title.Text = "redz Hub : Blox Fruits"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextColor3 = Colors.TextPrimary
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 12, 0, 0)
Title.Size = UDim2.new(1, -50, 1, 0)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local SubTitle = Instance.new("TextLabel")
SubTitle.Text = "by redz99999"
SubTitle.Font = Enum.Font.Gotham
SubTitle.TextSize = 12
SubTitle.TextColor3 = Colors.TextSecondary
SubTitle.BackgroundTransparency = 1
SubTitle.Position = UDim2.new(0, 150, 0, 0)
SubTitle.Size = UDim2.new(1, -150, 1, 0)
SubTitle.TextXAlignment = Enum.TextXAlignment.Left
SubTitle.Parent = Header

-- Sidebar (Khung chứa các nút Tab)
local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, SIDEBAR_WIDTH, 1, -36) -- Chiều cao full trừ Header
Sidebar.Position = UDim2.new(0, 0, 0, 36)
Sidebar.BackgroundColor3 = Colors.Sidebar
Sidebar.BorderSizePixel = 0
Sidebar.Parent = Main

-- Layout cho các nút Tab
local ListLayout = Instance.new("UIListLayout")
ListLayout.Padding = UDim.new(0, 4)
ListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
ListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ListLayout.Parent = Sidebar

-- Padding cho Sidebar
local Padding = Instance.new("UIPadding")
Padding.PaddingTop = UDim.new(0, 8)
Padding.PaddingBottom = UDim.new(0, 8)
Padding.Parent = Sidebar

-- Khung nội dung chính (phần bên phải)
local MainContent = Instance.new("Frame")
MainContent.Name = "MainContent"
MainContent.Size = UDim2.new(1, -SIDEBAR_WIDTH, 1, -36)
MainContent.Position = UDim2.new(0, SIDEBAR_WIDTH, 0, 36)
MainContent.BackgroundColor3 = Colors.Background
MainContent.BorderSizePixel = 0
MainContent.Parent = Main

-- HÀM TẠO NÚT TAB
local function CreateTabButton(name, iconId, order)
    local TabButton = Instance.new("TextButton")
    TabButton.Name = name .. "Tab"
    TabButton.Text = "" 
    TabButton.Size = UDim2.new(1, -16, 0, 40) -- Chiều rộng 100% Sidebar - 16px padding
    TabButton.BackgroundColor3 = Colors.TabButton
    TabButton.BorderSizePixel = 0
    TabButton.LayoutOrder = order
    TabButton.Parent = Sidebar

    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 6)
    TabCorner.Parent = TabButton

    -- Icon
    local Icon = Instance.new("ImageLabel")
    Icon.Name = "Icon"
    Icon.Image = iconId
    Icon.Size = UDim2.new(0, 24, 0, 24)
    Icon.Position = UDim2.new(0, 16, 0.5, -12)
    Icon.BackgroundTransparency = 1
    Icon.ImageColor3 = Colors.TextPrimary
    Icon.Parent = TabButton

    -- Tên Tab
    local TabName = Instance.new("TextLabel")
    TabName.Text = name:gsub("([A-Z])", " %1"):sub(2) 
    if name == "Fruit" then TabName.Text = "Fruit/Raid" end
    if name == "Quests" then TabName.Text = "Quests/Items" end
    
    TabName.Font = Enum.Font.SourceSansBold
    TabName.TextSize = 15
    TabName.TextColor3 = Colors.TextPrimary
    TabName.BackgroundTransparency = 1
    TabName.Size = UDim2.new(1, -60, 1, 0)
    TabName.Position = UDim2.new(0, 45, 0, 0)
    TabName.TextXAlignment = Enum.TextXAlignment.Left
    TabName.Parent = TabButton

    -- Màu Highlight (Thanh màu hồng đậm bên trái/đã thay thành nền)
    local Highlight = Instance.new("Frame")
    Highlight.Name = "Highlight"
    Highlight.Size = UDim2.new(0, 4, 1, 0)
    Highlight.BackgroundColor3 = Colors.Accent
    Highlight.Position = UDim2.new(0, 0, 0, 0)
    Highlight.Visible = false 
    Highlight.Parent = TabButton
    
    -- Tạo Frame nội dung cho Tab
    local TabContent = Instance.new("Frame")
    TabContent.Name = name .. "Content"
    TabContent.Size = UDim2.new(1, 0, 1, 0)
    TabContent.BackgroundTransparency = 1
    TabContent.Visible = false
    TabContent.Parent = MainContent
    
    -- THÊM SỰ KIỆN

    -- Hover
    TabButton.MouseEnter:Connect(function()
        if TabButton.BackgroundColor3 ~= Colors.TabActive then
            TweenService:Create(TabButton, TweenInfo.new(0.1), {BackgroundColor3 = Colors.TabHover}):Play()
        end
    end)
    TabButton.MouseLeave:Connect(function()
        if TabButton.BackgroundColor3 ~= Colors.TabActive then
            TweenService:Create(TabButton, TweenInfo.new(0.1), {BackgroundColor3 = Colors.TabButton}):Play()
        end
    end)

    return TabButton, TabContent
end

-- Mảng chứa tất cả các Tab (để quản lý việc chọn Tab)
local TabButtons = {}
local TabContents = {}

-- Sắp xếp và tạo các Tab
local TabNames = {
    "Discord", "Farm", "Sea", "Islands", "Quests", "Fruit", "Stats", "Teleport", "Visual", "Shop", "Misc"
}

for order, name in ipairs(TabNames) do
    local TabBtn, TabCont = CreateTabButton(name, IconIDs[name], order)
    TabButtons[name] = TabBtn
    TabContents[name] = TabCont
end

-- HÀM CHỌN TAB
local activeTab = nil

local function SelectTab(tabName)
    -- Bỏ chọn tab cũ
    if activeTab and TabButtons[activeTab] then
        TabButtons[activeTab].Highlight.Visible = false
        TweenService:Create(TabButtons[activeTab], TweenInfo.new(0.1), {BackgroundColor3 = Colors.TabButton}):Play()
        TabContents[activeTab].Visible = false
        -- Đổi màu icon/text về màu đậm (màu bình thường)
        TabButtons[activeTab].Icon.ImageColor3 = Colors.TextPrimary
        TabButtons[activeTab].TabName.TextColor3 = Colors.TextPrimary
    end

    -- Chọn tab mới
    local newTabBtn = TabButtons[tabName]
    local newTabCont = TabContents[tabName]
    
    if newTabBtn and newTabCont then
        newTabBtn.Highlight.Visible = true
        TweenService:Create(newTabBtn, TweenInfo.new(0.1), {BackgroundColor3 = Colors.TabActive}):Play()
        newTabCont.Visible = true
        activeTab = tabName
        -- Đổi màu icon/text về màu hồng đậm (màu đang chọn)
        newTabBtn.Icon.ImageColor3 = Colors.Accent
        newTabBtn.TabName.TextColor3 = Colors.Accent
    end
end

-- Thêm sự kiện click cho các nút Tab
for name, btn in pairs(TabButtons) do
    btn.MouseButton1Click:Connect(function()
        SelectTab(name)
    end)
end

-- Chọn tab "Quests/Items" mặc định
SelectTab(TabNames[5])

-- Chức năng Nút tắt (CloseBtn)
local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "✖"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 20
CloseBtn.TextColor3 = Colors.White
CloseBtn.BackgroundTransparency = 1
CloseBtn.Size = UDim2.new(0, 35, 1, 0)
CloseBtn.Position = UDim2.new(1, -35, 0, 0)
CloseBtn.Parent = Header

-- HÀM TẮT/MỞ MENU
local isVisible = true -- Bắt đầu với trạng thái MỞ

local function ToggleMenu(instant)
    isVisible = not isVisible
    if isVisible then
        Main.Visible = true
        -- Hiển thị MainFrame về vị trí giữa màn hình
        TweenService:Create(Main, TweenInfo.new(instant and 0 or 0.2), {Position = UDim2.new(0.5, -MAIN_SIZE_X / 2, 0.5, -MAIN_SIZE_Y / 2)}):Play()
        -- Nút toggle trở lại màu Hồng phấn
        TweenService:Create(ToggleBtn, TweenInfo.new(instant and 0 or 0.2), {BackgroundColor3 = Colors.ToggleBtn}):Play()
        TweenService:Create(ToggleStroke, TweenInfo.new(instant and 0 or 0.2), {Color = Colors.ToggleStroke}):Play()
    else
        -- Ẩn MainFrame lên trên
        TweenService:Create(Main, TweenInfo.new(instant and 0 or 0.15), {Position = UDim2.new(0.5, -MAIN_SIZE_X / 2, -1, 0)}):Play()
        -- Nút toggle đổi sang màu Hồng đậm/Accent
        TweenService:Create(ToggleBtn, TweenInfo.new(instant and 0 or 0.15), {BackgroundColor3 = Colors.Accent}):Play()
        TweenService:Create(ToggleStroke, TweenInfo.new(instant and 0 or 0.15), {Color = Colors.Accent}):Play()
        wait(instant and 0 or 0.15)
        Main.Visible = false
    end
end

-- Sự kiện click nút Toggle
ToggleBtn.MouseButton1Click:Connect(function()
    ToggleMenu(false)
end)

-- Sự kiện click nút X
CloseBtn.MouseButton1Click:Connect(function()
    ToggleMenu(false)
end)

-- Hiệu ứng hover cho nút X
CloseBtn.MouseEnter:Connect(function()
    TweenService:Create(CloseBtn, TweenInfo.new(0.1), {TextColor3 = Color3.fromRGB(80, 30, 60)}):Play()
end)
CloseBtn.MouseLeave:Connect(function()
    TweenService:Create(CloseBtn, TweenInfo.new(0.1), {TextColor3 = Colors.White}):Play()
end)

-- Hiệu ứng hover cho nút toggle
ToggleBtn.MouseEnter:Connect(function()
    TweenService:Create(ToggleBtn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
    TweenService:Create(ToggleStroke, TweenInfo.new(0.1), {Color = Colors.Accent}):Play()
end)

ToggleBtn.MouseLeave:Connect(function()
    TweenService:Create(ToggleBtn, TweenInfo.new(0.1), {BackgroundColor3 = Colors.ToggleBtn}):Play()
    TweenService:Create(ToggleStroke, TweenInfo.new(0.1), {Color = Colors.ToggleStroke}):Play()
end)
